# Release Notes

## [v1.1.1] 移动层进式用户体验大升级 & 数据库幂等热修复

🎉 **重大更新：现在你可以邀请家人或好友一起管理你的家庭空间了！** 🎉

### 📱 彻底的移动端可用性打磨
* **批量录入页极致响应式重构**：挥别移动端横向滑动的表格操作梦魇。当屏幕降级至手机端尺寸时，多字段复杂表格将如同魔术般转变为高度易读易用、拇指好点的**“单列组合流式卡片”**！大屏端表格原汁原味，手机端则体验轻盈。
* **首页核心视觉优先级重制**：将庞大的数据看板极尽收缩。在移动端上彻底清空那些无关痛痒的大字报卡片，浓缩为地图上方的精巧“数据胶囊”。现在，手机版打开后将直接将**搜索框与家庭平面图顶上视线盲区的第一位**。

### 🐞 高危功能阻断 Bug 修复
* **重构家庭共享底层逻辑，解决加载白屏**：修复了在读取已被邀请成员时，由于外键缺失导致 Supabase PostgREST 报出 `PGRST200 / 400 Bad Request` 的死锁问题，联表查询重新活络。
* **彻底排除遗留脏数据干扰**：清除了 `family_members` 表内存在的对不上用户的“幽灵数据”（孤儿记录），一举解决了部署外键锁时产生的 `ERROR 23503` 强制截断问题。
* **SQL 脚本彻底迈向无限次安全重试（幂等性）**：全面升级底层的更新脚本机制，现在重复创建权限策略不会再出现 `ERROR 42710 already exists`。系统会在修改规则前自动销毁重名规则，确保您任何时候跑都能稳定地 100% 成功生效。

---

## [v1.1.0] 家庭共享与多空间切换能力发布

### 1. 独家邀请码分享
* **自动生成专属邀请码**：系统会为您当前的个人数据空间自动生成一个独一无二的 6 位“家庭邀请码”。
* **一键复制与分享**：随时可以通过新增加的“家庭共享”面板复制这个码，发送给您的伴侣、家人或室友。

### 2. 多据空间无缝切换
* **加入他人家庭**：拿到邀请码后，输入对应的代码即可自动连通对应的家庭数据空间。
* **隔离与共享两不误**：加入他人的家并不会影响到本来的“属于自己的家”。你可以通过共享面板轻松在“我的家”与“他人的家”之间点击切换，分别查看各自独立的物品与平面图！
* **醒目状态提示**：如果您目前正处于非默认（他人的家庭）数据状态去操作，应用界面顶部会有清晰的黄色显眼标识，避免搞混。

### 3. 数据隔离与安全下放同步 (Supabase RLS)
* **安全共享，实时互通**：不再只是独自收纳，只要在一个分享空间下，家庭内任一成员新增了一个“存储位置”、摆放了一件“物品”甚至更改了房型图，其他家庭成员都可以立即查看和修改。这一切操作都会被底层数据库严密保护，确保其他外人无权访问你的家。

## 🛠️ 其他改动与增强
* 新增 `family_invites` 和 `family_members` 两张表以映射和控制多用户的从属逻辑。
* 彻底重构了内部的状态管理（`useStore`）代码，使其完全支持并发多家庭的环境变量与数据隔离查询逻辑。

---
> **⚡ 升级必备操作说明（核心）：**
> 对于这次的从底层的重大学术更新，请务必执行包含在这版代码内的 SQL 更新脚本 `update-schema.sql`，前往对应项目的 **Supabase SQL Editor** 执行才能保证正常体验分享系统！
